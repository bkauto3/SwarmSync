<!DOCTYPE html>
<html>
<head>
    <title>Direct NextAuth Test</title>
</head>
<body>
    <h1>Direct NextAuth OAuth Test</h1>
    <button id="testGoogle">Test Google OAuth</button>
    <div id="output"></div>

    <script type="module">
        const output = document.getElementById('output');

        document.getElementById('testGoogle').addEventListener('click', async () => {
            output.innerHTML = '<p>Testing...</p>';

            try {
                // Get CSRF token
                const csrfResponse = await fetch('https://swarmsync.ai/api/auth/csrf');
                const { csrfToken } = await csrfResponse.json();
                output.innerHTML += `<p>✓ Got CSRF token: ${csrfToken.substring(0, 20)}...</p>`;

                // Try to initiate Google OAuth
                const response = await fetch('https://swarmsync.ai/api/auth/signin/google', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        csrfToken: csrfToken,
                        callbackUrl: 'https://swarmsync.ai/dashboard',
                        json: 'true'
                    }),
                    redirect: 'manual'
                });

                output.innerHTML += `<p>Response status: ${response.status}</p>`;
                output.innerHTML += `<p>Response type: ${response.type}</p>`;

                const responseText = await response.text();
                output.innerHTML += `<p>Response: ${responseText.substring(0, 200)}</p>`;

                if (response.status === 0) {
                    output.innerHTML += `<p>⚠️ CORS or network error - this might be the issue</p>`;
                }

            } catch (error) {
                output.innerHTML += `<p>❌ ERROR: ${error.message}</p>`;
                console.error(error);
            }
        });
    </script>
</body>
</html>
